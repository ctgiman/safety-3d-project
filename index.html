<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 安全衛生訓練系統 - 掃描成果展示</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #2c3e50; color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        nav { background: #1a252f; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .logo { font-size: 20px; font-weight: bold; color: #3498db; }
        main { flex: 1; display: flex; position: relative; }
        #canvas-container { flex: 1; background: radial-gradient(circle, #455a64, #263238); }
        #side-panel { width: 320px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 20px; border-left: 1px solid rgba(255,255,255,0.2); overflow-y: auto; }
        h2 { color: #3498db; border-bottom: 2px solid #3498db; padding-bottom: 10px; font-size: 1.2rem; }
        .info-card { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        
        /* 切換模型按鈕樣式 */
        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .model-btn { 
            background: #34495e; color: white; border: 1px solid #3498db; padding: 12px; 
            border-radius: 5px; cursor: pointer; transition: 0.3s; text-align: left;
        }
        .model-btn:hover { background: #3498db; }
        .model-btn.active { background: #3498db; box-shadow: 0 0 10px rgba(52, 152, 219, 0.5); }
        
        .hazard-btn { background: #e74c3c; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .hazard-btn:hover { background: #c0392b; }
        #status-tag { padding: 4px 8px; border-radius: 4px; font-size: 12px; background: #f39c12; }
    </style>
</head>
<body>

    <nav>
        <div class="logo">安全衛生 3D 訓練系統</div>
        <div>
            <span id="status-tag">準備中...</span>
        </div>
    </nav>

    <main>
        <div id="canvas-container"></div>
        
        <div id="side-panel">
            <h2>模型庫 (掃描成果)</h2>
            <div class="btn-group">
                <button class="model-btn active" onclick="switchModel('model1.glb', this)">成果 A：初始掃描</button>
                <button class="model-btn" onclick="switchModel('model2.glb', this)">成果 B：細節優化</button>
                <button class="model-btn" onclick="switchModel('model3.glb', this)">成果 C：環境補償</button>
                <button class="model-btn" onclick="switchModel('model4.glb', this)">成果 D：最終導出</button>
            </div>

            <h2>器材資訊</h2>
            <div class="info-card">
                <p><strong>目前顯示：</strong> <span id="model-name">model1.glb</span></p>
                <p><strong>類型：</strong> 工程安全帽</p>
            </div>
            
            <button class="hazard-btn" onclick="alert('標示模式啟動：請縮放模型觀察表面瑕疵')">開啟危害標示模式</button>
        </div>
    </main>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/examples/jsm/controls/OrbitControls": "https://unpkg.com/three@0.128.0/examples/jsm/controls/OrbitControls.js",
                "three/examples/jsm/loaders/GLTFLoader": "https://unpkg.com/three@0.128.0/examples/jsm/loaders/GLTFLoader.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';
        import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';

        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        
        // 設定相機
        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(2, 2, 2);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // 強烈一點的光源，因為安全帽是白色的
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        const loader = new GLTFLoader();
        let currentModel = null;

        // 【核心功能】切換模型
        window.switchModel = function(modelName, btnElement) {
            // 更新 UI 狀態
            document.getElementById('status-tag').innerText = "載入中...";
            document.getElementById('status-tag').style.background = "#f39c12";
            document.getElementById('model-name').innerText = modelName;
            
            // 更新按鈕顏色
            document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');

            // 移除舊模型
            if (currentModel) {
                scene.remove(currentModel);
            }

            // 載入新模型
            const path = './models/' + modelName;
            loader.load(path, (gltf) => {
                currentModel = gltf.scene;
                
                // 自動居中模型
                const box = new THREE.Box3().setFromObject(currentModel);
                const center = box.getCenter(new THREE.Vector3());
                currentModel.position.sub(center);
                
                scene.add(currentModel);
                document.getElementById('status-tag').innerText = "載入成功";
                document.getElementById('status-tag').style.background = "#27ae60";
            }, 
            (xhr) => {
                // 進度顯示 (可選)
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            (error) => {
                console.error(error);
                document.getElementById('status-tag').innerText = "載入失敗";
                document.getElementById('status-tag').style.background = "#e74c3c";
            });
        }

        // 頁面開啟時預設載入第一個
        switchModel('model1.glb');

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>
</body>
</html>
